!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(1),i=n(2),a=n(8),o=n(3);n(9),n(6),n(7),$(function(){function e(e){R=!1,C&&C.abort(),S.userId=$(".patient.selected").data("visitorInfo").patientID,C=$.ajax({url:o.GetDataURL,type:"get",data:{mName:"searchCardNo",pContent:JSON.stringify(S)},beforeSend:function(){!e&&p.show(),e||(_.addClass("disabled"),$(".card").not(".template").remove(),v.children(".card-type").text("").end().children(".card-no").text("").end().data("cardInfo",null),m.hide(),$(".select-card").show())},complete:function(e,t){C=null,R=!0,p.hide();var n=e.responseText?e.responseText.trim():"";if(""===n||o.rhtml.test(n))"abort"!==t&&alert(o.NET_ERROR);else{var r=JSON.parse(n);if("1"!==r.rspCode)m.add($(".warning")).show(),I.open();else{var i=r.rspData.body,a=0,s=[],c=i.length;if(_.toggleClass("disabled",!c),$(".warning").toggle(!c),c){for(var d=$(".card.template"),l=d.clone(!0).removeClass("template");c>a;a++){var h=i[a],u=l.clone(!0);+h.siFlag||(!s.length&&u.addClass("selected"),u.find(".card-no").text(h.cardNo).end().data("cardInfo",h).insertBefore(d),s.push(h))}s.length&&($(".select-card").hide(),$(".card-type").text(s[0].cardName),v.find(".card-no").text(s[0].cardNo).end().data("cardInfo",s[0]))}else I.open()}}}})}var t=a.val("transData"),n=t?JSON.parse(t):{},s=($(".card-wrap"),$(".alert-window"));n.imgURL&&$(".doc-img").on("error",function(e){$(this).attr("src",o.DEFAULT_DOC_IMG_SRC)}).attr("src",n.imgURL);var c=n.seeTime,d=1==c.length?o.SeeTimeStrings[parseInt(c)-1]:c;$(".time").text(n.clinicDate+" "+o.Weekdays[n.clinicDate.toDate().getDay()]+" "+d),$(".doc-name").text(n.expertName),$(".dep-name").text(n.depName),$(".hos-name").text(n.hspName),$(".charge").text(n.totalFee),$(".need-to-know").on("touchend",function(e){location.href="need_to_know"});var l=i.decode(r.get("idnum")),p=($(".overlayer"),$(".loading.visitor-loading")),h={userID:l},u=!1,f=0;if($(".edit-patient").on("touchend",function(e){location.href="my_visitors"}),$(".patient").tap(function(t,i){var a=$(i);$(".patient.selected").removeClass("selected"),a.addClass("selected"),r.add("select_p_index",a.index(),{expires:1/24/60*5}),n.bRegister&&e()}),l&&$.ajax({url:o.GetDataURL,type:"get",data:{mName:"searchCommonlyUsers",pContent:JSON.stringify(h)},beforeSend:function(){p.show()},complete:function(t){!n.bRegister&&p.hide();var a=t.responseText?t.responseText.trim():"";if(""===a||o.rhtml.test(a))alert(o.NET_ERROR);else{var c=JSON.parse(a);if("1"!==c.rspCode)s.alert(c.rspMsg,!0);else{var d=c.rspData.body,h=$.grep(d,function(e,t){return t.patientID===l}),g=$(".patient.template"),m=g.clone(!0).removeClass("template");!h.length&&d.unshift({userId:l,patientName:decodeURIComponent(i.decode(r.get("name"))),patientID:l,patientPhoneNum:decodeURIComponent(i.decode(r.get("phone")))});for(var v=0,_=d.length;_>v;v++){var I=d[v],x=m.clone(!0);(n.typeId!==o.RegisterType.FETCH||n.idNo===I.patientID)&&x.find(".patient-name").text(I.patientName).end().data("visitorInfo",I).insertBefore(g)}$(".patient").eq(r.get("select_p_index")||0).addClass("selected"),u=!0,f=_,n.bRegister&&e(!0)}}}}),n.bRegister){$(".register-unique").show();var g=$(".cards-window"),m=$(".no-card"),v=$(".card-info"),_=$(".card-content"),I=$(".alert-wrap.prompt"),x=$(".alert-wrap.unsupported"),C=null,R=!1,S={searchPath:"3",hospitalCode:o.HSPCODE};I.bindTouchHandler({".confirm":function(e){e.preventDefault(),I.close()}}),x.bindTouchHandler({".confirm":function(e){e.preventDefault(),x.close()}}),$(".card-content").tap(function(e,t){!$(t).is(".disabled")&&R&&g.show()}),g.bindTouchHandler({".layer, .cancel":function(e){e.preventDefault(),g.hide()},".confirm":function(e){e.preventDefault();var t=$(".card.selected");if(t.length){var n=t.data("cardInfo");v.data("cardInfo",n).children(".card-type").text(n.cardName).end().children(".card-no").text(n.cardNo)}g.hide()}}),$(".card").tap(function(e,t){e.preventDefault(),$(".card.selected").removeClass("selected"),$(t).addClass("selected")})}$(".reserve-btn").tap(function(e,t){if(!(!u||n.bRegister&&C)){var r=($(t),$(".patient.selected").data("visitorInfo")),i=r.patientID,a=(r.patientName,{hospitalCode:n.hspCode,userId:i,scheduFlow:n.scheduFlow,oprUserId:l,sectionId:n.sectionId,typeId:n.typeId,reservationFrom:n.reservationFrom});n.bRegister?(cardInfo=v.data("cardInfo"),cardInfo?+cardInfo.siFlag?x.open():(a.cardNo=cardInfo.cardNo,a.cardNoType=cardInfo.cardNoType,location.href="register_result?transData="+encodeURIComponent(JSON.stringify(a))):I.open()):(a.seeTime=n.seeTime,location.href="reserve_result?transData="+encodeURIComponent(JSON.stringify(a)))}})})},function(e,t){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),e.exports={defaults:{},extend:function(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t},cookie:function(e,t,n){if(void 0!==t){if(e.match(/\W/))throw new Error("characters out bounds of [0-9a-zA-Z_] are illegal");var n=n||this.defaults;if("number"==typeof n.expires){var r=new Date;return r.setTime(+r+864e5*n.expires),document.cookie=[e,"=",t,n.expires?"; expires="+r.toGMTString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}}for(var i=document.cookie,a=i.split(";"),o=0,s=a.length;s>o;o++){var c=a[o].trim(),d=c.indexOf("=");if(c.slice(0,d)===e)return c.slice(d+1)}return""},add:function(e,t,n){this.cookie(e,t,n)},get:function(e){return this.cookie(e)},remove:function(e,t){this.cookie(e,"invalid",this.extend(t,{expires:-1}))},removeAll:function(e){for(var t=document.cookie,n=t.split(";"),r=0,i=n.length;i>r;r++){var a=n[r].split("=")[0].trim();this.remove(a,e)}}}},function(e,t){e.exports={b64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){if(!e)return"";e=encodeURIComponent(e);var t,n,r,i,a,o,s,c,d=this.b64,l=0,p=e.length,h=[],u=0;do t=e.charCodeAt(l++),n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=t<<16|n<<8|r,a=i>>18&63,o=i>>12&63,s=i>>6&63,c=63&i,h[u++]=d.charAt(a)+d.charAt(o)+d.charAt(s)+d.charAt(c);while(p>l);var f=h.join(""),g=p%3;return(g?f.slice(0,g-3):f)+"===".slice(g||3)},decode:function(e){if(!e)return"";if(!/^(?:[a-zA-Z\d\+\/=]{4})*$/.test(e))throw new Error("invalid base64 string");var t,n,r,i,a,o,s,c,d=this.b64,l=0,p=e.length,h=[],u=0;do t=d.indexOf(e.charAt(l++)),n=d.indexOf(e.charAt(l++)),r=d.indexOf(e.charAt(l++)),i=d.indexOf(e.charAt(l++)),a=t<<18|n<<12|r<<6|i,o=a>>16&255,s=a>>8&255,c=255&a,64==r?h[u++]=String.fromCharCode(o):64==i?h[u++]=String.fromCharCode(o,s):h[u++]=String.fromCharCode(o,s,c);while(p>l);return decodeURIComponent(h.join(""))}}},function(e,t,n){var r=n(4),i={app:"glwx",pltId:"03",productId:"010",version:"1.00.00",wxAppId:"wx97e1952c1a0281a4",GetDataURL:location.origin+"/support/get_data",appColumnsMap:{"001":{cols:[{nodeId:225,level:1,title:"健康科普",thumbnail_path:"/assets/glwx/img/thumbnail.png"},{nodeId:229,level:1,title:"营养养生",thumbnail_path:"/assets/glwx/img/thumbnail.png"},{nodeId:230,level:1,title:"通知公告",thumbnail_path:"/assets/glwx/img/thumbnail.png"}],style_extensions:"condensed color-inverse",article_based:!0,article_cols:[{nodeId:238,bRecm:!0,style_extensions:"float first-stressed"},{nodeId:239}]},"007":{cols:[{nodeId:93,level:1,title:"医院动态"},{nodeId:94,level:1,title:"学科动态"},{nodeId:89,level:1,title:"健康科普"},{nodeId:90,level:1,title:"媒体报道"}],style_extensions:"first-stressed"}},HSPCODE:"23101",HSPNAME:"南京市鼓楼医院",DEFAULT_MAX_INTRO_LENGTH:25,MAX_SEARCH_TIMES:10,DEFAULT_HOS_LOGO_IMG_SRC:"/assets/gcwx/img/hsp_logo_default.png",DEFAULT_DOC_IMG_SRC:"/assets/gcwx/img/doc_default.png",DEFAULT_HSP_IMG_SRC:"/assets/gcwx/img/hsp_default.png",SEND_DEFAULT:"点击发送验证码",SENDING:"验证码发送中",SEND_SUCCESS:"输入验证码",SEND_FAILED:"发送失败点击重发"};for(var a in r)i[a]=r[a];i.ajaxSetting({redirectPageName:"sign_in",redirectExcept:["sign_in","sign_up","validate","forget","home_info","info_list","hsp_sign_in","hsp_home","hsp_account","hsp_foregift","hsp_daily_bill"]}),e.exports=i},function(e,t,n){n(5);var r={NET_ERROR:"网络连接错误，请刷新重试！",GET_DATA_ERROR:"数据请求异常",COOKIE_NOT_AVAILABLE:"Cookie当前不可用！请检查浏览器设置",rhtml:/^<(?:\s|.)*>$/,IS_WX:/MicroMessenger/i.test(navigator.userAgent),ajaxSetting:function(e){if(window.$&&$.ajaxSetup){var t=location.pathname.match(/(\/(?:\w+\/)*)(\w+)?/),r=e.redirectPageName,i=this;t&&(pageName=t[2])&&(r+=[location.search?location.search+"&":"?","referrer="+pageName].join("")),$.ajaxSetup({dataType:"json",data:{pltId:this.pltId,productId:this.productId,version:this.version,sessionId:n(1).get("sid")},success:function(t,n){if("1"!==t.rspCode)switch(t.rspCode){case"9004":case"9005":e.sidHandler?e.sidHandler():location.href=i.IS_WX?i.getWxAuthPath(r):r}},complete:function(e,t){var n=e.responseText&&e.responseText.trim();if(""===n||i.rhtml.test(n))switch(t){case"success":alert(i.GET_DATA_ERROR);break;case"error":alert(i.NET_ERROR);break;case"abort":break;default:console.log(t),this._error&&this._error.call(this,t)}else try{this._complete&&this._complete.call(this,JSON.parse(n))}catch(r){console.log(r)}}})}},getFullPath:function(e){var t=location.pathname.match(/(\/(?:\w+\/)*)(?:\w+)?/)[1];return[location.origin,t,e].join("")},getWxAuthPath:function(e){return"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.wxAppId+"&redirect_uri="+encodeURIComponent(this.getFullPath(e))+"&response_type=code&scope=snsapi_base#wechat_redirect"},ModifyCommonUser:{ADD:"1",UPDATE:"2",DELETE:"3"},RegisterType:{REGISTER:"1",FETCH:"2",CHARGE:"3"},RegisterTypeMap:{1:"挂号",2:"取号",3:"缴费"},BusinessType:{REGISTER:"1",RESET_PASSWORD:"2",CASE_HISTORY:"3",RESERVE_RECORD:"4",SEE_REPORT:"5"},PayMethod:{TELE_FARE:"00",ONLINE_PAY:"01",UNION_WAP_PAY:"010",ALI_PAY:"02",WX_PAY:"03",OFFLINE_PAY:"05"},ChannelCode:{BD:"01",WX:"02",ALI:"03",YM:"04"},CardTypes:["医疗卡","医保卡"],ReportPrintStatus:["未打印","已打印","检测中"],Status:["已违约","已取消","取号/挂号成功","预约可取消","预约不可取消","可支付","预约成功","业务处理中/挂号处理中","挂号失败","已退号","历史挂号记录"],Weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],SeeTimeStrings:["上午","中午","下午","夜晚","早班","全天"],NORMAL:"普通号",INFO_IMG_SRC:"http://cms.jiankang51.cn",COUNTDOWN_MINUTES:60};e.exports=r},function(e,t){String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)==e}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")})},function(e,t){!function(e){e.fn.tap=function(t){return this.each(function(){var n=e(this),r=/mobile|windows phone|ios|android/i.test(navigator.userAgent);if(t)if(r){var i,a,o,s;n.on("touchstart",function(e){var t=e.originalEvent.touches[0];i=t.pageX,o=t.pageY}),n.on("touchend",function(e){if(e=e.originalEvent,"function"==typeof t)if(e){var n=e.changedTouches[0];a=n.pageX,s=n.pageY,Math.abs(a-i)<6&&Math.abs(s-o)<6&&t.call(this,e,this)}else t.call(this,e,this)})}else n.on("click",function(e){t.call(this,e,this)});else n.triggerHandler(r?"touchend":"click")}),this}}(jQuery)},function(e,t){!function(e){e.fn.extend({alert:function(t,n,r){var i=e(this);i.find(".alert-window-info").text(t),n&&i.addClass("failed"),i.ajustToCenter().fadeIn(250),setTimeout(function(){i.fadeOut(250,function(){r&&r(),i.removeClass("failed")})},2e3)},ajustToCenter:function(){var t=e(this);return t.css({top:function(){return e("body").scrollTop()+e(window).height()/2-t.height()/2},margin:"0 auto"})},open:function(t,n,r){var i=e(this);return t&&i.find(".alert-title").text(t),n&&i.find(".alert-desc").text(n),i.show(),r&&"function"==typeof r&&r(),i},close:function(){return e(this).hide()},bindTouchHandler:function(t,n,r){var i={};return this.each(function(){var r=e(this),a=i.toString.call(t).match(/\[object (\w+)\]/)[1].toLowerCase(),o=/mobile|windows phone|ios|android/i.test(navigator.userAgent),s=o?"touchend":"click";if("object"===a)for(var c in t){var d=t[c];r.find(c).on(s,{$elem:r},d)}else"string"===a&&r.find(t).on(s,{$elem:r},n)}),this}})}(jQuery)},function(e,t){e.exports={val:function(e,t){var n=decodeURIComponent(location.search),r=-1!==n.indexOf("#")?n.indexOf("#"):n.length,i=n?n.slice(1,r):null,a={},o=a.toString,s=[];if(i)for(var c=i.split("&"),d=0,l=c.length;l>d;d++){var p=c[d],h=p.indexOf("=");a[p.slice(0,h)]=p.slice(h+1)}if(void 0===e)return a;if(void 0!==t)a[e]=t;else{if("string"==typeof e)return a[e]||"";if("[object Object]"!==o.call(e))return"";for(var u in e)a[u]=e[u]}for(var u in a)s.push(u+"="+a[u]);location.search="?"+encodeURIComponent(s.join("&"))}}},function(e,t){Date.prototype.format=function(e){for(var t=e.split(/[^a-zA-Z]/),n=0,r=t.length,i={yyyy:this.getFullYear(),mm:this.getMonth()+1,dd:this.getDate(),hh:this.getHours(),MM:this.getMinutes(),ss:this.getSeconds()};r>n;n++){var a=t[n],o=i[a];a in i&&(e=e.replace(a,10>o?"0"+o:o))}return e},String.prototype.toDate=function(e){var t=new Date;if(/^\d*$/.test(this))t.setDate(this.slice(6,8)),t.setMonth(parseInt(this.slice(4,6))-1),t.setFullYear(this.slice(0,4));else if(e=e||this.match(/[^\w]/)[0]){var n=this.split(e);t.setDate(n[2]),t.setMonth(parseInt(n[1])-1),t.setFullYear(n[0])}return t},Date.prototype.isSameDayWith=function(e){return e?this.getDate()===e.getDate()&&this.getMonth()===e.getMonth()&&this.getFullYear()===e.getFullYear():!1}}]);