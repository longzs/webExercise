!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i=n(1),r=n(2),a=n(3);n(6),n(7),$(function(){function e(e){if(!x){var i={typeId:3,hospitalCode:a.HSPCODE,payMethod:a.PayMethod.WX_PAY,oprUserId:n,userId:e.userId,flow:e.preNo,cardNo:e.cardNo,cardNoType:e.cardNoType,wxTradeType:"JSAPI",openId:o,appId:m.appId};x=$.ajax({url:a.GetDataURL,type:"get",dataType:"json",data:{mName:"registerRequestPay",pContent:JSON.stringify(i)},beforeSend:function(){S.show()},complete:function(n){S.hide(),x=null;var i=n.responseText?n.responseText.trim():"";if(""===i||a.rhtml.test(i))alert(a.NET_ERROR);else{var r=JSON.parse(i);if("1"!==r.rspCode)l.alert(r.rspMsg,!0);else{var o=r.rspData;wx.chooseWXPay({timestamp:o.timeStamp,nonceStr:o.nonceStr,"package":"prepay_id="+o.prepayId,signType:"MD5",paySign:o.paySign,success:function(n){t(o.rcptStreamNo,e.itemName)},error:function(){l.alert("支付失败")}})}}}})}}function t(e,t){$.ajax({url:a.GetDataURL,type:"get",dataType:"json",data:{mName:"getMyOrderInfo",pContent:JSON.stringify({hospitalCode:a.HSPCODE,rcptStreamNo:e,userId:n,queryType:"3"})},beforeSend:function(){I.show()},complete:function(e){var t=e.responseText?e.responseText.trim():"";if(""===t||a.rhtml.test(t))alert(a.NET_ERROR);else{I.hide();var n=JSON.parse(t);if("1"!==n.rspCode)l.alert(n.rspMsg,!0);else{var i=n.rspData.body;if(i.length){var r=i[0];if("1"==r.tranceStatus)l.alert("缴费成功！两秒后页面将自动刷新",!1,function(){location.reload()});else if("0"==r.tranceStatus)l.alert("缴费失败，请尝试刷新以查看订单状态",!0);else{var o=$(".alert-wrap.processing");o.bindTouchHandler({".confirm":function(e){e.preventDefault(),o.close()}}),o.open()}}else l.alert("未查询到相应订单，请尝试刷新以查看订单状态",!0)}}}})}var n=i.get("idnum"),o=i.get("openId");if(o){n=r.decode(n),o=r.decode(o);var s,d,c=$(".tab-view"),l=$(".alert-window"),p=$(".loading.wait-loading"),f=$(".loading.his-loading"),u={hospitalCode:a.HSPCODE,userId:n,typeId:"1"},h={hospitalCode:a.HSPCODE,userId:n,typeId:"1"};decodeURIComponent(r.decode(i.get("name")));$(".tabs").on("touchend",function(e){$(".tab.selected").removeClass("selected");var t=$(e.target).addClass("selected"),n=c.eq(t.index());c.each(function(e){$(this).toggle(e==t.index())}),n.is(".charged")&&(s||d||(d=$.ajax({url:a.GetDataURL,type:"get",data:{mName:"searchPrenosInfo",pContent:JSON.stringify(h)},beforeSend:function(){f.show()},complete:function(e){f.hide(),d=null;var t=e.responseText?e.responseText.trim():"";if(""===t||a.rhtml.test(t))alert(a.NET_ERROR);else{var n=JSON.parse(t);if("1"!==n.rspCode)l.alert(n.rspMsg,!0);else{s=!0;var i=n.rspData.paymentBody,r=0,o=i.length,c=$(".his.template"),p=c.clone(!0).removeClass("template");if(o)for(;o>r;r++){var u=i[r],h=p.clone(!0),m=u.detailList,g=u.dupInvoiceList,x=$.map(g,function(e,t){return e.excDeptName});if(h.find(".name").text(u.patientName).end().find(".time").text(u.transDate).end().find(".doc-name").text(u.expertName).end().find(".exec-dep").text(x.join("，")).end().find(".total").text(u.totalFee),m.length)for(var v=h.find(".medicine.template"),_=v.clone(!0).removeClass("template"),S=0,I=m.length;I>S;S++){var E=m[S],C=_.clone(!0);C.find(".medi-name").text(E.itemName).end().find(".speci").text(E.itemSpec).end().find(".unit-price").text(E.itemPrice).end().find(".amount").text(E.itemAmount).end().find(".price").text(E.itemCharges).end().insertBefore(v)}h.insertBefore(c)}else $(".no-charged").show()}}}})))}),$(".known").on("touchend",function(e){$(".prompt").hide()}),$(".container").tap(function(e,t){e.stopPropagation(),$(t).parent().toggleClass("unfold")}),$.ajax({url:a.GetDataURL,type:"get",data:{mName:"searchPrenosInfo",pContent:JSON.stringify(u)},beforeSend:function(){p.show()},complete:function(e){p.hide();var t=e.responseText?e.responseText.trim():"";if(""===t||a.rhtml.test(t))alert(a.NET_ERROR);else{var n=JSON.parse(t);if("1"!==n.rspCode)l.alert(n.rspMsg,!0);else{bWaitSearched=!0;var i=n.rspData.unPaymentBody,r=0,o=i.length,s=$(".wait.template"),d=s.clone(!0).removeClass("template");if(o){for(;o>r;r++){var c=i[r],f=d.clone(!0),u=c.detailList;c.dupInvoiceList;if(f.find(".name").text(c.patientName).end().find(".dep-name").text(c.departmentName).end().find(".time").text(c.transDate).end().find(".exec-dep").text(c.excDeptName).end().find(".total").text(c.totalFee).end().data("preNoInfo",c),u.length)for(var h=f.find(".medicine.template"),m=h.clone(!0).removeClass("template"),g=0,x=u.length;x>g;g++){var v=u[g],_=m.clone(!0);_.find(".medi-name").text(v.itemName).end().find(".speci").text(v.itemSpec).end().find(".unit-price").text(v.itemPrice).end().find(".amount").text(v.itemAmount).end().find(".price").text(v.itemCharges).end().insertBefore(h)}f.insertBefore(s)}$(".waits .sum-wrap").show()}else $(".no-waits").show()}}}});var m,g,x,v=location.href,_=$(".overlayer.config"),S=$(".loading.request"),I=$(".loading.result");-1!==(g=v.indexOf("#"))&&(v=v.slice(0,g)),wx.ready(function(){_.hide()}),wx.error(function(){_.hide(),l.alert("微信配置失败，请尝试刷新",!0)}),$.ajax({url:a.GetDataURL,type:"get",dataType:"json",data:{mName:"getWeiXinCertificate",pContent:JSON.stringify({appId:a.wxAppId,url:encodeURIComponent(v)})},complete:function(e,t){var n=e.responseText?e.responseText.trim():"";if(""===n||a.rhtml.test(n))alert(a.NET_ERROR);else{var i=JSON.parse(n);"1"!==i.rspCode?l.alert(i.rspMsg,!0):(m=i.signInfo,wx.config({debug:!1,appId:m.appId,timestamp:m.timestamp,nonceStr:m.nonceStr,signature:m.signature,jsApiList:["chooseWXPay"]}))}}}),$(".charge-btn").on("touchend",function(t){var n=$(this);if(!n.is(".disabled")){var i=n.closest(".wait"),r=i.data("preNoInfo");e(r)}})}else location.href=a.IS_WX?a.getWxAuthPath("sign_in?referrer=charge"):"sign_in?referrer=charge"})},function(e,t){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),e.exports={defaults:{},extend:function(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t},cookie:function(e,t,n){if(void 0!==t){if(e.match(/\W/))throw new Error("characters out bounds of [0-9a-zA-Z_] are illegal");var n=n||this.defaults;if("number"==typeof n.expires){var i=new Date;return i.setTime(+i+864e5*n.expires),document.cookie=[e,"=",t,n.expires?"; expires="+i.toGMTString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}}for(var r=document.cookie,a=r.split(";"),o=0,s=a.length;s>o;o++){var d=a[o].trim(),c=d.indexOf("=");if(d.slice(0,c)===e)return d.slice(c+1)}return""},add:function(e,t,n){this.cookie(e,t,n)},get:function(e){return this.cookie(e)},remove:function(e,t){this.cookie(e,"invalid",this.extend(t,{expires:-1}))},removeAll:function(e){for(var t=document.cookie,n=t.split(";"),i=0,r=n.length;r>i;i++){var a=n[i].split("=")[0].trim();this.remove(a,e)}}}},function(e,t){e.exports={b64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){if(!e)return"";e=encodeURIComponent(e);var t,n,i,r,a,o,s,d,c=this.b64,l=0,p=e.length,f=[],u=0;do t=e.charCodeAt(l++),n=e.charCodeAt(l++),i=e.charCodeAt(l++),r=t<<16|n<<8|i,a=r>>18&63,o=r>>12&63,s=r>>6&63,d=63&r,f[u++]=c.charAt(a)+c.charAt(o)+c.charAt(s)+c.charAt(d);while(p>l);var h=f.join(""),m=p%3;return(m?h.slice(0,m-3):h)+"===".slice(m||3)},decode:function(e){if(!e)return"";if(!/^(?:[a-zA-Z\d\+\/=]{4})*$/.test(e))throw new Error("invalid base64 string");var t,n,i,r,a,o,s,d,c=this.b64,l=0,p=e.length,f=[],u=0;do t=c.indexOf(e.charAt(l++)),n=c.indexOf(e.charAt(l++)),i=c.indexOf(e.charAt(l++)),r=c.indexOf(e.charAt(l++)),a=t<<18|n<<12|i<<6|r,o=a>>16&255,s=a>>8&255,d=255&a,64==i?f[u++]=String.fromCharCode(o):64==r?f[u++]=String.fromCharCode(o,s):f[u++]=String.fromCharCode(o,s,d);while(p>l);return decodeURIComponent(f.join(""))}}},function(e,t,n){var i=n(4),r={app:"glwx",pltId:"03",productId:"010",version:"1.00.00",wxAppId:"wx97e1952c1a0281a4",GetDataURL:location.origin+"/support/get_data",appColumnsMap:{"001":{cols:[{nodeId:225,level:1,title:"健康科普",thumbnail_path:"/assets/glwx/img/thumbnail.png"},{nodeId:229,level:1,title:"营养养生",thumbnail_path:"/assets/glwx/img/thumbnail.png"},{nodeId:230,level:1,title:"通知公告",thumbnail_path:"/assets/glwx/img/thumbnail.png"}],style_extensions:"condensed color-inverse",article_based:!0,article_cols:[{nodeId:238,bRecm:!0,style_extensions:"float first-stressed"},{nodeId:239}]},"007":{cols:[{nodeId:93,level:1,title:"医院动态"},{nodeId:94,level:1,title:"学科动态"},{nodeId:89,level:1,title:"健康科普"},{nodeId:90,level:1,title:"媒体报道"}],style_extensions:"first-stressed"}},HSPCODE:"23101",HSPNAME:"南京市鼓楼医院",DEFAULT_MAX_INTRO_LENGTH:25,MAX_SEARCH_TIMES:10,DEFAULT_HOS_LOGO_IMG_SRC:"/assets/gcwx/img/hsp_logo_default.png",DEFAULT_DOC_IMG_SRC:"/assets/gcwx/img/doc_default.png",DEFAULT_HSP_IMG_SRC:"/assets/gcwx/img/hsp_default.png",SEND_DEFAULT:"点击发送验证码",SENDING:"验证码发送中",SEND_SUCCESS:"输入验证码",SEND_FAILED:"发送失败点击重发"};for(var a in i)r[a]=i[a];r.ajaxSetting({redirectPageName:"sign_in",redirectExcept:["sign_in","sign_up","validate","forget","home_info","info_list","hsp_sign_in","hsp_home","hsp_account","hsp_foregift","hsp_daily_bill"]}),e.exports=r},function(e,t,n){n(5);var i={NET_ERROR:"网络连接错误，请刷新重试！",GET_DATA_ERROR:"数据请求异常",COOKIE_NOT_AVAILABLE:"Cookie当前不可用！请检查浏览器设置",rhtml:/^<(?:\s|.)*>$/,IS_WX:/MicroMessenger/i.test(navigator.userAgent),ajaxSetting:function(e){if(window.$&&$.ajaxSetup){var t=location.pathname.match(/(\/(?:\w+\/)*)(\w+)?/),i=e.redirectPageName,r=this;t&&(pageName=t[2])&&(i+=[location.search?location.search+"&":"?","referrer="+pageName].join("")),$.ajaxSetup({dataType:"json",data:{pltId:this.pltId,productId:this.productId,version:this.version,sessionId:n(1).get("sid")},success:function(t,n){if("1"!==t.rspCode)switch(t.rspCode){case"9004":case"9005":e.sidHandler?e.sidHandler():location.href=r.IS_WX?r.getWxAuthPath(i):i}},complete:function(e,t){var n=e.responseText&&e.responseText.trim();if(""===n||r.rhtml.test(n))switch(t){case"success":alert(r.GET_DATA_ERROR);break;case"error":alert(r.NET_ERROR);break;case"abort":break;default:console.log(t),this._error&&this._error.call(this,t)}else try{this._complete&&this._complete.call(this,JSON.parse(n))}catch(i){console.log(i)}}})}},getFullPath:function(e){var t=location.pathname.match(/(\/(?:\w+\/)*)(?:\w+)?/)[1];return[location.origin,t,e].join("")},getWxAuthPath:function(e){return"https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.wxAppId+"&redirect_uri="+encodeURIComponent(this.getFullPath(e))+"&response_type=code&scope=snsapi_base#wechat_redirect"},ModifyCommonUser:{ADD:"1",UPDATE:"2",DELETE:"3"},RegisterType:{REGISTER:"1",FETCH:"2",CHARGE:"3"},RegisterTypeMap:{1:"挂号",2:"取号",3:"缴费"},BusinessType:{REGISTER:"1",RESET_PASSWORD:"2",CASE_HISTORY:"3",RESERVE_RECORD:"4",SEE_REPORT:"5"},PayMethod:{TELE_FARE:"00",ONLINE_PAY:"01",UNION_WAP_PAY:"010",ALI_PAY:"02",WX_PAY:"03",OFFLINE_PAY:"05"},ChannelCode:{BD:"01",WX:"02",ALI:"03",YM:"04"},CardTypes:["医疗卡","医保卡"],ReportPrintStatus:["未打印","已打印","检测中"],Status:["已违约","已取消","取号/挂号成功","预约可取消","预约不可取消","可支付","预约成功","业务处理中/挂号处理中","挂号失败","已退号","历史挂号记录"],Weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],SeeTimeStrings:["上午","中午","下午","夜晚","早班","全天"],NORMAL:"普通号",INFO_IMG_SRC:"http://cms.jiankang51.cn",COUNTDOWN_MINUTES:60};e.exports=i},function(e,t){String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)==e}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")})},function(e,t){!function(e){e.fn.tap=function(t){return this.each(function(){var n=e(this),i=/mobile|windows phone|ios|android/i.test(navigator.userAgent);if(t)if(i){var r,a,o,s;n.on("touchstart",function(e){var t=e.originalEvent.touches[0];r=t.pageX,o=t.pageY}),n.on("touchend",function(e){if(e=e.originalEvent,"function"==typeof t)if(e){var n=e.changedTouches[0];a=n.pageX,s=n.pageY,Math.abs(a-r)<6&&Math.abs(s-o)<6&&t.call(this,e,this)}else t.call(this,e,this)})}else n.on("click",function(e){t.call(this,e,this)});else n.triggerHandler(i?"touchend":"click")}),this}}(jQuery)},function(e,t){!function(e){e.fn.extend({alert:function(t,n,i){var r=e(this);r.find(".alert-window-info").text(t),n&&r.addClass("failed"),r.ajustToCenter().fadeIn(250),setTimeout(function(){r.fadeOut(250,function(){i&&i(),r.removeClass("failed")})},2e3)},ajustToCenter:function(){var t=e(this);return t.css({top:function(){return e("body").scrollTop()+e(window).height()/2-t.height()/2},margin:"0 auto"})},open:function(t,n,i){var r=e(this);return t&&r.find(".alert-title").text(t),n&&r.find(".alert-desc").text(n),r.show(),i&&"function"==typeof i&&i(),r},close:function(){return e(this).hide()},bindTouchHandler:function(t,n,i){var r={};return this.each(function(){var i=e(this),a=r.toString.call(t).match(/\[object (\w+)\]/)[1].toLowerCase(),o=/mobile|windows phone|ios|android/i.test(navigator.userAgent),s=o?"touchend":"click";if("object"===a)for(var d in t){var c=t[d];i.find(d).on(s,{$elem:i},c)}else"string"===a&&i.find(t).on(s,{$elem:i},n)}),this}})}(jQuery)}]);